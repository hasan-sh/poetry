(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{155:function(e,t,a){},156:function(e,t,a){},157:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(80),c=a.n(r),i=(a(90),a(17)),s=a(163),l=(a(91),a(81)),u=a.n(l),m=a(6),p=a(14),b=a(12),d=a(7),g=a(10),f=a(4),h=(a(38),a(3)),y=a(37),O=a.n(y);a(142),a(144),a(158);O.a.initializeApp({apiKey:"AIzaSyDZwpbPbCtMCtkLCgY3LaOHGEkR4M1BzOw",authDomain:"my-poetry-app.firebaseapp.com",databaseURL:"https://my-poetry-app.firebaseio.com",projectId:"my-poetry-app",storageBucket:"my-poetry-app.appspot.com",messagingSenderId:"341809310539"});var j,v,E,w,S,P,k,x=O.a.auth,C=O.a.firestore,N=O.a.storage,L=(j=Object(p.persist)("list"),v=function(){function e(){Object(m.a)(this,e),Object(d.a)(this,"poems",E,this),Object(d.a)(this,"updatePoems",w,this),Object(d.a)(this,"getPoem",S,this),Object(d.a)(this,"addPoem",P,this),Object(d.a)(this,"updatePoem",k,this)}return Object(g.a)(e,[{key:"getPoems",get:function(){return this.poems}}]),e}(),E=Object(f.a)(v.prototype,"poems",[j,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(f.a)(v.prototype,"getPoems",[h.computed],Object.getOwnPropertyDescriptor(v.prototype,"getPoems"),v.prototype),w=Object(f.a)(v.prototype,"updatePoems",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.poems=t}}}),S=Object(f.a)(v.prototype,"getPoem",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return e.poems.find(function(e){return e.id===t})}}}),P=Object(f.a)(v.prototype,"addPoem",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e,t){return new Promise(function(a,n){var o=x().currentUser;if(!o)return n("No user recognized");if(console.log(o.uid,e.userId),!_(e.userId))return n("Not allowed user!");if(e.imageName!==t.name){if(e.imageSrc&&e.imageName)N().ref("photos/".concat(e.imageName)).delete().then(function(){return console.log("removed",e.imageName)}).catch(function(e){console.error(e),n(!1)});var r=N().ref("photos/".concat(t.name)),c=r.put(t);c.on("state_changed",null,null,function(){return function(e,t,a){return t.getDownloadURL().then(function(t){return e.id?C().collection("/poems").doc(e.id).update(Object(b.a)({},e,{imageSrc:t,imageName:a,timestamp:C.Timestamp.fromMillis(Date.now())})):C().collection("/poems").doc().set(Object(b.a)({},e,{imageSrc:t,imageName:a,timestamp:C.Timestamp.fromMillis(Date.now())}))})}(e,r,t.name).then(function(){return a(!0)}).catch(function(e){console.error(e),n(!1)})}),c.catch(function(e){console.error(e),n(!1)})}else(function(e){return e.id?C().collection("/poems").doc(e.id).update(Object(b.a)({},e,{timestamp:C.Timestamp.fromMillis(Date.now())})):C().collection("/poems").doc().set(Object(b.a)({},e,{timestamp:C.Timestamp.fromMillis(Date.now())}))})(e).then(function(){return a(!0)}).catch(function(e){console.error(e),n(!1)})})}}}),k=Object(f.a)(v.prototype,"updatePoem",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e){C().collection("/poems").doc(e.id).set(Object(b.a)({},e,{timestamp:C.Timestamp.fromMillis(Date.now())}))}}}),v);function _(e){var t=x().currentUser;return t&&t.uid===e}Object(n.createContext)(new L);var I,z,R,A,D,B,M,T,U,F,H,Y,W,J,q,Z,G=(I=Object(p.persist)("object"),z=Object(p.persist)("object"),R=function(){function e(){Object(m.a)(this,e),Object(d.a)(this,"lastSelected",A,this),Object(d.a)(this,"selectedPoem",D,this),Object(d.a)(this,"removeSelected",B,this),Object(d.a)(this,"setSelectedPoem",M,this)}return Object(g.a)(e,[{key:"getSelectedPoem",get:function(){return this.selectedPoem}}]),e}(),A=Object(f.a)(R.prototype,"lastSelected",[I,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=Object(f.a)(R.prototype,"selectedPoem",[z,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(f.a)(R.prototype,"getSelectedPoem",[h.computed],Object.getOwnPropertyDescriptor(R.prototype,"getSelectedPoem"),R.prototype),B=Object(f.a)(R.prototype,"removeSelected",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.selectedPoem=null}}}),M=Object(f.a)(R.prototype,"setSelectedPoem",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,a){e.selectedPoem=Object(b.a)({},t,{y:a}),e.lastSelected=e.selectedPoem}}}),R),K=(T=function(){function e(){Object(m.a)(this,e),Object(d.a)(this,"language",U,this),Object(d.a)(this,"isRtl",F,this)}return Object(g.a)(e,[{key:"setIsRtl",value:function(e){this.isRtl=e}},{key:"setLanguage",value:function(e){this.language=e}},{key:"getLanguage",get:function(){return this.language}}]),e}(),U=Object(f.a)(T.prototype,"language",[p.persist,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"en"}}),F=Object(f.a)(T.prototype,"isRtl",[p.persist,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(f.a)(T.prototype,"setIsRtl",[h.action],Object.getOwnPropertyDescriptor(T.prototype,"setIsRtl"),T.prototype),Object(f.a)(T.prototype,"getLanguage",[h.computed],Object.getOwnPropertyDescriptor(T.prototype,"getLanguage"),T.prototype),Object(f.a)(T.prototype,"setLanguage",[h.action],Object.getOwnPropertyDescriptor(T.prototype,"setLanguage"),T.prototype),T),V=(H=Object(p.persist)("object"),Y=function(){function e(){Object(m.a)(this,e),Object(d.a)(this,"user",W,this),Object(d.a)(this,"anonymous",J,this),Object(d.a)(this,"setUser",q,this),Object(d.a)(this,"setAnonymous",Z,this)}return Object(g.a)(e,[{key:"isLoggedIn",get:function(){return this.user&&this.user.loggedIn}},{key:"isAnonymous",get:function(){return this.anonymous}}]),e}(),W=Object(f.a)(Y.prototype,"user",[H,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=Object(f.a)(Y.prototype,"anonymous",[p.persist,h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(f.a)(Y.prototype,"isLoggedIn",[h.computed],Object.getOwnPropertyDescriptor(Y.prototype,"isLoggedIn"),Y.prototype),Object(f.a)(Y.prototype,"isAnonymous",[h.computed],Object.getOwnPropertyDescriptor(Y.prototype,"isAnonymous"),Y.prototype),q=Object(f.a)(Y.prototype,"setUser",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.user=t}}}),Z=Object(f.a)(Y.prototype,"setAnonymous",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.anonymous=t}}}),Y),$=Object(p.create)({storage:localStorage,jsonify:!0}),Q=Object(n.createContext)(new function e(){Object(m.a)(this,e),this.userStore=new V,this.poemStore=new L,this.selectedPoemStore=new G,this.settings=new K,$("user",this.userStore),$("poem",this.poemStore),$("selectedPoem",this.selectedPoemStore),$("language",this.settings)}),X=function(){var e=Object(n.useContext)(Q);return Object(n.useEffect)(function(){var t=window.navigator.language,a=u.a.isRtlLang(t);e.settings.setIsRtl(a)},[]),null},ee=a(26),te=a(165),ae=a(161),ne=a(63),oe=a.n(ne),re=a(82),ce=a(64),ie=a.n(ce),se=a(159),le=a(83),ue=a.n(le),me=function(e){var t=e.disable,a=e.next,o=e.back,r=e.title,c=e.containerClassName,i=Object(n.useContext)(Q).settings.isRtl;return n.createElement("div",{className:"buttons ".concat(i?"rtl":""," ").concat(c)},n.createElement("button",{disabled:t,className:"btn pink update",onClick:a},r||"Update"),o?n.createElement("button",{className:"btn back",onClick:o,style:{color:"white",backgroundColor:"transparent"}},"Back"):n.createElement(se.a,{to:"/",className:"btn ".concat(ue.a.back)},"Back"))},pe=Object(i.a)(function(e){var t=e.history,a=e.match,r=Object(n.useContext)(Q),c=r.poemStore,i=c.addPoem,s=c.getPoem,l=r.userStore.isLoggedIn,u=Object(n.useState)(null),m=Object(ee.a)(u,2),p=m[0],d=m[1],g=Object(n.useState)({}),f=Object(ee.a)(g,2),h=f[0],y=f[1],O=Object(n.useState)(null),j=Object(ee.a)(O,2),v=j[0],E=j[1],w=Object(n.useState)(!l&&"Only logged in users can add poems!"),S=Object(ee.a)(w,2),P=S[0],k=S[1],x=a.params.id||"";function C(e){return N.apply(this,arguments)}function N(){return(N=Object(re.a)(oe.a.mark(function e(a){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),v){e.next=3;break}return e.abrupt("return",k("Please make sure to choose an image!"));case 3:return e.next=5,i(h,v);case 5:(n=e.sent)?t.push("/poems"):(console.error(n),k("Something has gone wrong!"));case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}return Object(n.useEffect)(function(){var e={};x&&(e=s(x)),y(e)},[x]),Object(n.useEffect)(function(){if(h.id&&x){var e=new File([h.imageSrc],h.imageName||"image.jpg");E(e)}},[h]),o.a.createElement("form",{className:"container ".concat(ie.a.form),onSubmit:C},o.a.createElement("b",{style:{color:"white"}},P),o.a.createElement("input",{type:"text",placeholder:"Title",onChange:function(e){var t=e.target.value;return y(Object(b.a)({},h,{title:t}))},value:h.title||"",required:!0,disabled:!l}),o.a.createElement("input",{type:"text",placeholder:"Author",onChange:function(e){var t=e.target.value;return y(Object(b.a)({},h,{author:t}))},value:h.author||"",required:!0,disabled:!l}),o.a.createElement("textarea",{placeholder:"Poem",onChange:function(e){var t=e.target.value;return y(Object(b.a)({},h,{text:t}))},value:h.text||"",required:!0,disabled:!l}),x&&h&&o.a.createElement("div",{style:{width:200,height:200,minHeight:50,background:"url(".concat(p||h.imageSrc||"/images/default.jpg",") no-repeat center center/contain "),backgroundSize:"contain"}}),o.a.createElement("label",{htmlFor:"image"},"Image: ",v&&v.name,o.a.createElement("input",{type:"file",accept:"image/*",name:"your image",id:"image",onChange:function(e){var t=e.target.files[0];t&&(d(URL.createObjectURL(t)),E(t))},disabled:!l})),o.a.createElement(me,{disable:!l,next:C,title:!x&&"Add",containerClassName:ie.a.buttons}))}),be=a(160),de=a(164),ge=a(13),fe=a(65),he=a.n(fe),ye=Object(de.a)(function(e){var t=Object(n.useContext)(Q),a=t.userStore.user,r=t.selectedPoemStore.getSelectedPoem,c=Object(ge.b)({top:r?"-100%":"0%",from:{top:r?"0%":"-100%"}}),i=Object(be.a)("/login",{path:e.location.pathname,exact:!0,strict:!1});return o.a.createElement(ge.a.div,{style:c,className:he.a.container},a?o.a.createElement("h3",null,o.a.createElement("img",{src:a&&a.avatar,alt:"user",className:he.a.avatar}),"Hello,\xa0",o.a.createElement("i",null,a&&a.userName)):o.a.createElement(se.a,{className:"btn",to:i?"/poems":"/login"},i?"Poems":"Login"),o.a.createElement(se.a,{className:"btn",to:"/add"},"Add Poem"))}),Oe=a(49),je=a.n(Oe),ve=function(e){var t=Object(n.useContext)(Q).userStore,a=t.isLoggedIn,r=(t.isAnonymous,t.setAnonymous);Object(n.useEffect)(function(){if(a){var t=e.history.location.state&&e.history.location.state.from.pathname||"/";e.history.push(t)}},[a]);return o.a.createElement("div",{className:je.a.container},o.a.createElement("button",{className:"btn ".concat(je.a.loginButton," "),onClick:function(){var e=new x.GoogleAuthProvider;x().useDeviceLanguage(),e.addScope("email"),e.addScope("profile"),e.setCustomParameters({login_hint:"poet@example.com"}),x().signInWithRedirect(e)}},"Login"),o.a.createElement("button",{className:"btn ".concat(je.a.continue),onClick:function(){r(!0),e.history.push("/poems")}},"Anonymous"))},Ee=a(48),we=(a(155),Object(i.a)(function(e){var t=e.poem,a=(e.noHover,Object(ge.b)({delay:300*Math.round(Math.random()+3),from:{marginLeft:-10,opacity:0},marginLeft:0,opacity:1}));return o.a.createElement("div",{className:"poem"},o.a.createElement(ge.a.div,{style:a},o.a.createElement("div",{className:"title"},t.title),o.a.createElement("div",{className:"author"},t.author)))})),Se=(a(156),Object(de.a)(function(e){var t=e.poem,a=e.showContent,r=e.poemClicked,c=e.history,i=e.location,s=Object(n.useContext)(Q),l=s.settings.isRtl,u=s.selectedPoemStore,m=u.selectedPoem,p=u.removeSelected,b=s.userStore.user,d=Object(ge.c)(!!m,null,{enter:{height:"66.666%",opacity:1,delay:300},leave:{height:"0%",opacity:0,delay:300},from:{height:"0%",opacity:0,delay:300}}),g=Object(ge.b)({opacity:1,from:{opacity:0},delay:450}),f=_(b&&b.id||"");return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"poemContent ".concat(a?"":"hover"),onClick:function(e){var a=e.currentTarget.getBoundingClientRect(),n=a.top,o=a.height;r(t.id,n+window.scrollY,o)}},o.a.createElement("div",{className:"wrapper",style:{background:"url(".concat(t.imageSrc?t.imageSrc:"/images/default.jpg",") no-repeat center center "),backgroundSize:"cover"}}),o.a.createElement("div",{style:{zIndex:4,position:"relative"}},o.a.createElement(we,{poem:t,noHover:!0}),a&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"leftBorder ".concat(m?"show":"out"," ").concat(l?"rtl":"")})))),a&&d.map(function(e){var a=e.item,n=e.props,r=e.key;return a&&o.a.createElement(ge.a.div,{key:r,style:n},o.a.createElement("div",{className:"poemContainer"},o.a.createElement(ge.a.div,{style:g},o.a.createElement("div",{className:"poemText"},t.text),o.a.createElement(me,{disable:!f,next:function(){i.state="update",p(),setTimeout(function(){return c.replace("/update/".concat(t.id))},200)},back:function(){c.push("/"),setTimeout(p,200)}}))))}))})),Pe=Object(i.a)(function(e){var t=e.poem,a=Object(Ee.a)(e,["poem"]),r=Object(n.useContext)(Q),c=r.selectedPoemStore,i=c.getSelectedPoem,s=c.removeSelected,l=c.lastSelected,u=r.settings.isRtl,m=window.scrollY,p=Object(ge.c)(!!i,null,{enter:{height:"100%",width:"100%",zIndex:5,position:"absolute",top:m},leave:{height:"33.33%",width:"100%",zIndex:5,position:"absolute",top:l&&l.y||0},from:{height:"100%",width:"100%",zIndex:5,position:"absolute",top:l&&l.y||0}});return Object(n.useEffect)(function(){t&&i&&a.history.replace("/poem/".concat(t.id))},[i,t]),o.a.createElement(o.a.Fragment,null,o.a.createElement("svg",{className:"exit ".concat(i?"show":"out"," ").concat(u?"rtl":""),style:{top:m+20},onClick:function(){a.history.push("/"),setTimeout(s,200)}},o.a.createElement("path",{stroke:"black",strokeWidth:"4",fill:"none",d:"M6.25,6.25,17.75,17.75"}),o.a.createElement("path",{stroke:"black",strokeWidth:"4",fill:"none",d:"M6.25,17.75,17.75,6.25"})),p.map(function(e){var a=e.key,n=e.props;return e.item&&o.a.createElement(ge.a.div,{style:Object(b.a)({},n,{overflow:"auto"}),key:a},o.a.createElement(Se,{poemClicked:function(){return null},poem:t||l,showContent:!0}))}))}),ke=Object(de.a)(Pe),xe=Object(i.a)(function(e){var t=e.poemClicked,a=Object(n.useContext)(Q).poemStore.getPoems;return o.a.createElement(o.a.Fragment,null,a.length?a.map(function(e){return o.a.createElement(o.a.Fragment,{key:e.id},o.a.createElement(Se,{poemClicked:t,poem:e}))}):o.a.createElement("div",{className:"poemContent"},"No poems yet!"))}),Ce=a(162),Ne=function(e){var t=e.component,a=Object(Ee.a)(e,["component"]),r=Object(n.useContext)(Q).userStore,c=r.isLoggedIn,i=r.isAnonymous;r.anonymous;return o.a.createElement(ae.a,Object.assign({},a,{render:function(e){return c||i?o.a.createElement(t,e):o.a.createElement(Ce.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},Le=function(e){var t=Object(n.useContext)(Q),a=t.selectedPoemStore,r=a.setSelectedPoem,c=a.selectedPoem,i=t.poemStore.getPoem,s=Object(n.useState)(),l=Object(ee.a)(s,2),u=l[0],m=l[1];var p=function(e,t){var a=i(e);r(a,t),m(a)};return o.a.createElement("div",{style:{height:"100%"}},o.a.createElement(ye,null),o.a.createElement(te.a,null,o.a.createElement(ae.a,{path:"/",exact:!0,render:function(){return o.a.createElement(xe,{poemClicked:p})}}),o.a.createElement(Ne,{path:"/poems",exact:!0,component:function(){return o.a.createElement(xe,{poemClicked:p})}}),o.a.createElement(ae.a,{exact:!0,path:"/poem/:id",render:function(e){var t=i(e.match.params.id),a="update"===e.location.state;return t?(c||a||r(t,0),null):null}}),o.a.createElement(Ne,{path:"/add",exact:!0,component:pe}),o.a.createElement(Ne,{path:"/update/:id",exact:!0,component:pe}),o.a.createElement(ae.a,{path:"/login",component:ve})),o.a.createElement(ke,{poem:u||c}))},_e=Object(i.a)(function(){var e=Object(n.useContext)(Q),t=e.selectedPoemStore.selectedPoem,a=e.poemStore.updatePoems,r=e.settings.isRtl,c=e.userStore,i=c.setAnonymous,l=c.setUser;return Object(n.useEffect)(function(){x().getRedirectResult().catch(function(e){var t=e.message;console.error(t)}),x().onAuthStateChanged(function(e){e?(i(!1),l({id:e.uid,loggedIn:!0,userName:e.displayName,avatar:e.photoURL})):l(null)}),C().collection("/poems").onSnapshot(function(e){var t=[];e.forEach(function(e){var a=e.data(),n=a.author,o=a.title,r=a.text,c=a.id,i=a.userId,s=a.timestamp,l=a.imageSrc,u=a.imageName;t.push({author:n,title:o,text:r,id:c||e.id,userId:i,timestamp:s||Date.now(),imageSrc:l,imageName:u})}),a(t)})},[]),Object(n.useEffect)(function(){document.body.style.overflow=t?"hidden":"auto"},[t]),o.a.createElement("div",{className:"App",dir:r?"rtl":"ltr"},o.a.createElement(X,null),o.a.createElement(s.a,null,o.a.createElement(Le,null)))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},49:function(e,t,a){e.exports={container:"Login_container__vNhFF",continue:"Login_continue__3VSIx",loginButton:"Login_loginButton__x-ZhZ"}},64:function(e,t,a){e.exports={form:"AddPoem_form__2Lmhg",buttons:"AddPoem_buttons__2t-vF",back:"AddPoem_back__SbsJY"}},65:function(e,t,a){e.exports={container:"Header_container__3Nogs",avatar:"Header_avatar__Y7JYm"}},83:function(e,t,a){e.exports={back:"Buttons_back__1kCYo"}},85:function(e,t,a){e.exports=a(157)},90:function(e,t,a){},91:function(e,t,a){}},[[85,1,2]]]);
//# sourceMappingURL=main.b4b62c45.chunk.js.map